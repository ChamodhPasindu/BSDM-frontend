<c-modal id="liveDemoModal" size="lg" alignment="center" class="modal-scrollable" [visible]="visible"
  (visibleChange)="changeModalVisibility($event)">
  <c-modal-header>
    <h5 cModalTitle> Assign New Sale Stock</h5>
    <button (click)="closeModal()" cButtonClose></button>
  </c-modal-header>

  <c-modal-body>
    <c-row class="mb-3">
      <c-col [md]="4">
        <label cLabel for="datepicker">Load Date</label>
        <div class="input-group">
          <input type="text" placeholder="Choose a date" class="form-control" bsDatepicker />
          <span class="input-group-text bg-white">
            <svg cIcon name="cilCalendar" class="text-secondary"></svg>
          </span>
        </div>
      </c-col>
    </c-row>

    <c-row class="mb-3">
      <c-col [md]="4">
        <label cLabel for="driverSelect">Select Driver</label>
        <select id="driverSelect" class="form-select" [(ngModel)]="selectedDriver" (change)="onDriverChange()">
          <option value="" disabled selected>Select Driver</option>
          <option *ngFor="let driver of drivers" [value]="driver.id">
            {{ driver.name }}
          </option>
        </select>
      </c-col>

      <c-col [md]="4">
        <label cLabel for="vehicleSelect">Select Vehicle</label>
        <select id="vehicleSelect" class="form-select" [(ngModel)]="selectedVehicle" (change)="onVehicleChange()">
          <option value="" disabled selected>Select Vehicle</option>
          <option *ngFor="let vehicle of vehicles" [value]="vehicle.id">
            {{ vehicle.number }}
          </option>
        </select>
      </c-col>

      <c-col [md]="4">
        <label cLabel for="routeSelect">Select Route</label>
        <select id="routeSelect" class="form-select" [(ngModel)]="selectedRoute" (change)="onRouteChange()">
          <option value="" disabled selected>Select Route</option>
          <option *ngFor="let route of routes" [value]="route.id">
            {{ route.name }}
          </option>
        </select>
      </c-col>
    </c-row>

    <div class="border rounded p-3 bg-light mb-3" *ngIf="selectedDriver || selectedVehicle || selectedRoute">
      <h6 class="fw-bold text-dark mb-2">Assignment Details</h6>
      <p *ngIf="selectedDriver"><strong>Driver:</strong> {{ getDriverName(selectedDriver) }}</p>
      <p *ngIf="selectedVehicle"><strong>Vehicle:</strong> {{ getVehicleName(selectedVehicle) }}</p>
      <p *ngIf="selectedRoute"><strong>Route:</strong> {{ getRouteName(selectedRoute) }}</p>
    </div>

    <hr />

    <h6 class="mb-3">Product Selection</h6>
    <c-row>
      <c-col [md]="6">
        <input type="text" class="form-control mb-3" placeholder="Search product..." [(ngModel)]="searchText"
          (input)="filterProducts()" />

        <div>
          <c-accordion *ngIf="filteredProducts.length > 0; else noProducts">
            <c-accordion-item *ngFor="let product of filteredProducts; let i = index" [visible]="i === 0">
              <ng-template cTemplateId="accordionHeader">
                <div class="d-flex justify-content-between align-items-center w-100 me-2">
                  <span>{{ product.name }}</span>
                  <button cButton color="danger" variant="outline" size="sm" (click)="selectProduct(product)">
                    <svg cIcon name="cilHandPointUp"></svg> Pick
                  </button>
                </div>
              </ng-template>
              <ng-template cTemplateId="accordionBody">
                <p><strong>Category:</strong> {{ product.category }}</p>
                <p><strong>Available Stock:</strong> {{ product.stock }}</p>
              </ng-template>
            </c-accordion-item>
          </c-accordion>
          <div class="d-flex justify-content-center mt-3">
            <c-pagination align="center" aria-label="Product pagination">
              <li cPageItem>
                <a cPageLink>Previous</a>
              </li>

              <li cPageItem>
                <a cPageLink>Next</a>
              </li>
            </c-pagination>
          </div>

          <ng-template #noProducts>
            <c-alert color="secondary" class="text-center border-0">
              <div class="d-flex flex-column align-items-center p-3">
                <svg cIcon name="cilBan" size="4xl" class="mb-2 text-secondary"></svg>
                <h6 class="fw-semibold mb-1 text-dark">No products found</h6>
                <small class="text-muted">Try adjusting your search.</small>
              </div>
            </c-alert>
          </ng-template>
        </div>
      </c-col>

      <c-col [md]="6">
        <div *ngIf="selectedProduct; else noSelection">
          <div class="border rounded p-3 bg-light mb-2">
            <h6 class="fw-bold">{{ selectedProduct.name }}</h6>
            <p><strong>Category:</strong> {{ selectedProduct.category }}</p>
            <p><strong>Available Stock:</strong> {{ selectedProduct.stock }}</p>
          </div>
          <div class="mb-3">
            <label cLabel for="assignQty">Assign Quantity</label>
            <input id="assignQty" type="number" class="form-control" [(ngModel)]="selectedQuantity" />
          </div>

          <button cButton variant="outline" color="primary" class="w-100" (click)="addToCart()"
            [disabled]="!selectedQuantity">
            Add to Assign List
          </button>
        </div>

        <ng-template #noSelection>
          <c-alert color="secondary" class="text-center border-0 mt-4">
            <div class="d-flex flex-column align-items-center p-3">
              <svg cIcon name="cilBan" size="4xl" class="mb-2 text-secondary"></svg>
              <h6 class="fw-semibold mb-1 text-dark">No product selected</h6>
              <small class="text-muted">Select a product to view details</small>
            </div>
          </c-alert>
        </ng-template>
      </c-col>
    </c-row>

    <hr />

    <div *ngIf="cartItems.length > 0" class="mt-3">
      <h6 class="mb-3">Assigned Products</h6>
      <table [striped]="true" cTable class="border">
        <thead cTableColor="light">
          <tr>
            <th class="text-center">Product</th>
            <th>Quantity</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cartItems; let i = index">
            <td class="text-center">{{ item.name }}</td>
            <td>{{ item.quantity }}</td>
            <td class="text-center">
              <button cButton color="danger" size="sm" variant="ghost" (click)="removeFromCart(i)">
                <svg cIcon name="cilTrash"></svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </c-modal-body>
  <c-modal-footer>
    <button (click)="closeModal()" cButton color="secondary">
      Close
    </button>
    <button cButton color="primary">Assign Stock</button>
  </c-modal-footer>
</c-modal>